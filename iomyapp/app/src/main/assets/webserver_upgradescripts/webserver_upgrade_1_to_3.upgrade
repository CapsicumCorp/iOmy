; An upgrade script to migrate the web server files from version 1 to version 2
; skipfolderifexist skips files in that folder unless they don't exist
; skipfile will always re-extract if the file doesn't exist
; deletefolder will recursively delete everything in the folder
; changedfile entries will override skipfolder entries

;Move config files
mkdir components/etc
mkdir components/etc/lighttpd
mkdir components/etc/mysql
mkdir components/etc/php

movefile components/lighttpd/conf/lighttpd.conf.template components/etc/lighttpd/lighttpd.conf.template
movefile components/mysql/conf/mysql.ini.template components/etc/mysql/mysql.ini.template
movefile components/php/conf/php.ini.template components/etc/php/php.ini.template

movefile components/lighttpd/conf/lighttpd.conf components/etc/lighttpd/lighttpd.conf
movefile components/mysql/conf/mysql.ini components/etc/mysql/mysql.ini
movefile components/php/conf/php.ini components/etc/php/php.ini

;Old folders
deletefile components/lighttpd/sbin/lighttpd
deletefolder components/lighttpd
deletefolder components/php/conf
deletefolder components/mysql/conf

;Old binaries
deletefile components/bin/curl
deletefile components/bin/ffmpeg
deletefile components/lib/libSDL-1.2.so.0
deletefile components/lib/libaio.so.1
deletefile components/lib/libcrypto.so.1.0.0
deletefile components/lib/libcurl.so.5
deletefile components/lib/libfreetype.so.6
deletefile components/lib/libiconv.so.2
deletefile components/lib/libjpeg.so.62
deletefile components/lib/libmcrypt.so.4
deletefile components/lib/libpng16.so.16
deletefile components/lib/libssl.so.1.0.0
deletefile components/lib/libxml2.so.2
deletefile components/lib/libz.so.1

deletefile components/mysql/sbin/mysql
deletefile components/mysql/sbin/mysqlcheck
deletefile components/mysql/sbin/mysqld

;Files to skip in new extract
skipfile components/etc/lighttpd/lighttpd.conf.template
skipfile components/etc/php/php.ini.template

skipfile components/mysql/extra_bootstrap.sql
skipfile components/mysql/extra2_bootstrap.sql

;Always skip this folder as it contains the MySQL database
skipfolder components/mysql/sbin/data

skipfolderifexist components/mysql/sbin/share

skipfile scripts/find_systemapps.sh

skipfolderifexist tmp
skipfolderifexist var

skipfile zigbeedefs.ini

;Web Files
deletefile htdocs/restricted/config/iomy_vanilla.php_template

skipfolderifexist htdocs

;0.4.0 to 0.4.1
changedfile htdocs/restricted/libraries/dbfunctions.php
changedfile htdocs/restricted/libraries/dbmysql.php
changedfile htdocs/restricted/libraries/functions.php
changedfile htdocs/restricted/libraries/special/iomyserverlib.php
changedfile htdocs/restricted/php/api_onvif.php
changedfile htdocs/restricted/php/api_onvifthumbnail.php
changedfile htdocs/restricted/php/api_philipshue.php
changedfile htdocs/ui/mobile/app.js
changedfile htdocs/ui/mobile/mjs/premise/Overview.controller.js
changedfile htdocs/ui/mobile/mjs/rooms/UnassignedDevices.controller.js
changedfile htdocs/ui/mobile/resources/css/app.css
changedfile htdocs/ui/mobile/resources/css/capsicum_widths.css
changedfile htdocs/ui/mobile/resources/css/experimental_brent.css
changedfile htdocs/ui/mobile/resources/images/mainlogo.png
changedfile htdocs/ui/mobile/resources/images/minilogo.png
changedfile htdocs/ui/mobile/util/apiphp.js
changedfile htdocs/ui/mobile/util/devices/weatherfeed.js
changedfile htdocs/ui/mobile/util/devices.js
changedfile htdocs/ui/mobile/util/functions.js
changedfile htdocs/ui/mobile/util/widgets.js

;New Web Files
;changedfile htdocs/ui/mobile/util/devices/weatherfeed.js

;0.4.1 to 0.4.2
changedfile htdocs/iomyserver.php
changedfile htdocs/restricted/libraries/dbfunctions.php
changedfile htdocs/restricted/libraries/dbmysql.php
changedfile htdocs/restricted/libraries/functions.php
changedfile htdocs/restricted/libraries/http_post.php
changedfile htdocs/restricted/libraries/onvif.php
changedfile htdocs/restricted/libraries/philipshue.php
changedfile htdocs/restricted/libraries/restrictedapicore.php
changedfile htdocs/restricted/libraries/special/iomyserverlib.php
changedfile htdocs/restricted/libraries/userauth.php
changedfile htdocs/restricted/odata/services/main/MainMetadata.php
changedfile htdocs/restricted/odata/services/main/MainQueryProvider.php
changedfile htdocs/restricted/php/api_onvif.php
changedfile htdocs/restricted/php/api_philipshue.php
changedfile htdocs/restricted/php/api_statechange.php
changedfile htdocs/restricted/php/api_users.php
changedfile htdocs/restricted/php/special/versions/0.1.0.php
changedfile htdocs/ui/mobile/app.js
changedfile htdocs/ui/mobile/index.html
changedfile htdocs/ui/mobile/mjs/devices/DeviceOverview.controller.js
changedfile htdocs/ui/mobile/mjs/devices/OnvifCamera.controller.js
changedfile htdocs/ui/mobile/mjs/devices/PhilipsHue.controller.js
changedfile htdocs/ui/mobile/mjs/fragments/NavMenu.fragment.js
changedfile htdocs/ui/mobile/mjs/premise/Overview.controller.js
changedfile htdocs/ui/mobile/mjs/rooms/Room.controller.js
changedfile htdocs/ui/mobile/mjs/rooms/UnassignedDevices.controller.js
changedfile htdocs/ui/mobile/mjs/settings/devices/EditLink.controller.js
changedfile htdocs/ui/mobile/mjs/settings/devices/EditThing.controller.js
changedfile htdocs/ui/mobile/mjs/settings/links/LinkAdd.controller.js
changedfile htdocs/ui/mobile/mjs/settings/premise/PremiseEditAddress.controller.js
changedfile htdocs/ui/mobile/mjs/settings/premise/PremiseEditHub.controller.js
changedfile htdocs/ui/mobile/mjs/settings/premise/PremiseEditInfo.controller.js
changedfile htdocs/ui/mobile/mjs/settings/rooms/RoomAdd.controller.js
changedfile htdocs/ui/mobile/mjs/settings/rooms/RoomEdit.controller.js
changedfile htdocs/ui/mobile/mjs/settings/things/ItemAdd.controller.js
changedfile htdocs/ui/mobile/mjs/settings/user/EditUserAddress.controller.js
changedfile htdocs/ui/mobile/mjs/settings/user/EditUserInformation.controller.js
changedfile htdocs/ui/mobile/mjs/settings/user/UserEditPassword.controller.js
changedfile htdocs/ui/mobile/resources/css/app.css
changedfile htdocs/ui/mobile/resources/css/capsicum_margin.css
changedfile htdocs/ui/mobile/resources/css/capsicum_widths.css
changedfile htdocs/ui/mobile/util/apiodata.js
changedfile htdocs/ui/mobile/util/apiphp.js
changedfile htdocs/ui/mobile/util/devices/philipshue.js
changedfile htdocs/ui/mobile/util/devices/weatherfeed.js
changedfile htdocs/ui/mobile/util/devices/zigbeesmartplug.js
changedfile htdocs/ui/mobile/util/functions.js
changedfile htdocs/ui/mobile/util/widgets.js

deletefile htdocs/ui/mobile/mjs/rooms/DeviceIPCamera.controller.js
deletefile htdocs/ui/mobile/mjs/settings/EditUser.controller.js
deletefile htdocs/ui/mobile/mjs/settings/EditUser.view.js
deletefile htdocs/ui/mobile/mjs/settings/SettingsOverview.controller.js
deletefile htdocs/ui/mobile/mjs/settings/SettingsOverview.view.js
deletefile htdocs/ui/mobile/mjs/settings/devices/DeviceAddManually.controller.js
deletefile htdocs/ui/mobile/mjs/settings/devices/DeviceAddManually.view.js
deletefile htdocs/ui/mobile/mjs/settings/devices/DeviceInfo.controller.js
deletefile htdocs/ui/mobile/mjs/settings/devices/DeviceInfo.view.js
deletefile htdocs/ui/mobile/mjs/settings/premise/Premise.controller.js
deletefile htdocs/ui/mobile/mjs/settings/premise/Premise.view.js
deletefile htdocs/ui/mobile/mjs/settings/premise/PremiseViewInfo.controller.js
deletefile htdocs/ui/mobile/mjs/settings/premise/PremiseViewInfo.view.js
deletefile htdocs/ui/mobile/mjs/settings/rooms/RoomDevice.controller.js
deletefile htdocs/ui/mobile/mjs/settings/rooms/RoomDevice.view.js

;New Web Files
;changedfile htdocs/restricted/libraries/weather_owm.php
;changedfile htdocs/restricted/php/api_weather.php
;changedfile htdocs/ui/mobile/resources/icons/favicon.png

