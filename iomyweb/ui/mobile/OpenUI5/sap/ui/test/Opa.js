/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/Device'],function(q,D){"use strict";var $=q,a=[],c={};function i(C,o,f){if(window["sap-ui-debug"]){o.timeout=300;}var s=new Date();g();function g(){try{var r=C();}catch(h){f.reject(o);throw h;}if(r.result){b(f);return;}var t=new Date()-s;t/=1000;var p=Math.round(t%60);if(o.timeout>p){setTimeout(g,o.pollingInterval);return;}if(o.error){try{o.error(o,r.arguments);}finally{f.reject(o,r.arguments);}return;}f.reject(o);}}function b(f){var I=D.browser.msie?50:0;if(a.length===0){f.resolve();return true;}var g=a.shift();setTimeout(function(){i(g.callback,g.options,f);},I);}function e(p,n){var N=a.length-p;if(N){var f=a.splice(p,N);f.forEach(function(g){g.options._nestedIn=n;});a=f.concat(a);}}function d(f){f=(f||0)+2;if(D.browser.mozilla){f=f-1;}var E=new Error(),s=E.stack;if(!s){try{throw E();}catch(o){s=o.stack;}}if(!s){return"";}s=s.split("\n");s.splice(0,f);return s.join("\n");}var O=function(f){this.and=this;$.extend(this,f);};O.config={};O.extendConfig=function(o){O.config=q.extend(O.config,o);};O.resetConfig=function(){O.config={arrangements:new O(),actions:new O(),assertions:new O(),timeout:15,pollingInterval:400,_stackDropCount:0};};O.getContext=function(){return c;};O.emptyQueue=function emptyQueue(){function f(g){var r="\nCallstack:\n";if(g._stack){r+=g._stack;delete g._stack;}else{r+="Unknown";}if(g._nestedIn){r+=f(g._nestedIn);delete g._nestedIn;}return r;}var o=$.Deferred();b(o);return o.promise().fail(function(g){a=[];g.errorMessage=g.errorMessage||"Failed to wait for check";g.errorMessage+=f(g);q.sap.log.error(g.errorMessage);});};O.resetConfig();O.prototype={getContext:O.getContext,waitFor:function(o){var f=$.Deferred();o=$.extend({},O.config,o);o._stack=d(1+o._stackDropCount);delete o._stackDropCount;f.promise(this);a.push({callback:function(){var r=true;if(o.check){try{r=o.check.apply(this,arguments);}catch(g){f.reject(o);throw g;}}if(r){if(o.success){try{var C=a.length;o.success.apply(this,arguments);}catch(g){f.reject(o);throw g;}finally{e(C,o);}}f.resolve();return{result:true,arguments:arguments};}return{result:false,arguments:arguments};}.bind(this),options:o});return this;},extendConfig:O.extendConfig,emptyQueue:O.emptyQueue};return O;},true);
