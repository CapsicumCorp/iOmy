/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/support/Plugin'],function(q,P){"use strict";var I=P.extend("sap.ui.core.support.plugins.Interaction",{constructor:function(s){P.apply(this,["sapUiSupportInteraction","Interaction",s]);this._oStub=s;if(this.isToolPlugin()){this._aEventIds=[this.getId()+"SetMeasurements",this.getId()+"SetActive"];q.sap.require("sap.ui.core.format.DateFormat");var p=function(i,w){return("000"+String(i)).slice(-w);};this._fnFormatTime=function(n){var N=new Date(n),m=Math.floor((n-Math.floor(n))*1000);return p(N.getHours(),2)+":"+p(N.getMinutes(),2)+":"+p(N.getSeconds(),2)+"."+p(N.getMilliseconds(),3)+p(m,3);};}else{this._aEventIds=[this.getId()+"Refresh",this.getId()+"Clear",this.getId()+"Start",this.getId()+"Stop",this.getId()+"Activate"];}}});I.prototype.init=function(s){P.prototype.init.apply(this,arguments);if(this.isToolPlugin()){a.call(this,s);}else{b.call(this,s);}};I.prototype.exit=function(s){P.prototype.exit.apply(this,arguments);};function a(s){var r=sap.ui.getCore().createRenderManager();r.write("<div class=\"sapUiSupportToolbar\">");r.write("<button id=\""+this.getId()+"-refresh\" class=\"sapUiSupportBtn\">Refresh</button>");r.write("<button id=\""+this.getId()+"-clear\" class=\"sapUiSupportBtn\">Clear</button>");r.write("<input type=\"checkbox\" id=\""+this.getId()+"-active\" class=\"sapUiSupportChB\">");r.write("<label for=\""+this.getId()+"-active\" class=\"sapUiSupportLabel\">Active</label>");r.write("</div><div class=\"sapUiSupportInteractionCntnt\">");r.write("<table id=\""+this.getId()+"-tab\" width=\"100%\">");r.write("<colgroup><col><col><col><col><col><col></colgroup>");r.write("<thead style=\"text-align:left;\"><tr>");r.write("<th>Component</th>");r.write("<th>Trigger</th>");r.write("<th>Type</th>");r.write("<th>Start</th>");r.write("<th>End</th>");r.write("<th>Duration</th>");r.write("<th>Requests</th>");r.write("</tr></thead>");r.write("<tbody id=\""+this.getId()+"-tabBody\"></tbody>");r.write("</table></div>");r.flush(this.$().get(0));r.destroy();this.$("refresh").click(q.proxy(function(e){this._oStub.sendEvent(this.getId()+"Refresh");},this));this.$("clear").click(q.proxy(function(e){this._oStub.sendEvent(this.getId()+"Clear");},this));this.$("active").click(q.proxy(function(e){var A=false;if(this.$("active").prop("checked")){A=true;}this._oStub.sendEvent(this.getId()+"Activate",{"active":A});},this));}function b(s){g.call(this);}function g(s){var A=q.sap.interaction.getActive();var m=[];if(A){m=q.sap.measure.getAllInteractionMeasurements();}this._oStub.sendEvent(this.getId()+"SetMeasurements",{"measurements":m});this._oStub.sendEvent(this.getId()+"SetActive",{"active":A});}I.prototype.onsapUiSupportInteractionSetMeasurements=function(e){var m=e.getParameter("measurements");var t=this.$("tabBody");var r=sap.ui.getCore().createRenderManager();for(var i=0;i<m.length;i++){var M=m[i];r.write("<tr>");r.write("<td>"+M.component+"</td>");r.write("<td>"+M.trigger+"</td>");r.write("<td>"+M.event+"</td>");r.write("<td>"+this._fnFormatTime(M.start)+"</td>");r.write("<td>"+this._fnFormatTime(M.end)+"</td>");r.write("<td>"+M.duration+"</td>");r.write("<td>"+M.requests.length+"</td>");r.write("</tr>");}r.flush(t[0]);r.destroy();};I.prototype.onsapUiSupportInteractionSetActive=function(e){var A=e.getParameter("active");var c=this.$("active");if(A){c.attr("checked","checked");}else{c.removeAttr("checked");}};I.prototype.onsapUiSupportInteractionRefresh=function(e){g.call(this);};I.prototype.onsapUiSupportInteractionClear=function(e){q.sap.measure.clearInteractionMeasurements();this._oStub.sendEvent(this.getId()+"SetMeasurements",{"measurements":[]});};I.prototype.onsapUiSupportInteractionStart=function(e){q.sap.measure.start(this.getId()+"-perf","Measurement by support tool");};I.prototype.onsapUiSupportInteractionEnd=function(e){q.sap.measure.end(this.getId()+"-perf");};I.prototype.onsapUiSupportInteractionActivate=function(e){var A=e.getParameter("active");if(q.sap.interaction.getActive()!=A){q.sap.interaction.setActive(A);}};return I;});
